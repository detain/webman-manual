# عملية التشغيل

## عملية بدء العمل

بعد تنفيذ `php start.php start` ، يتم تنفيذ عملية التشغيل كما يلي:

1. تحميل التكوينات من مجلد config/
2. ضبط إعدادات العمل (Worker) ذات الصلة مثل `pid_file` `stdout_file` `log_file` `max_package_size` وغيرها
3. إنشاء عملية webman والاستماع إلى المنفذ (الإفتراضي 8787)
4. إنشاء عمليات مخصصة وفقًا للتكوين
5. بعد بدء تشغيل عملية webman والعمليات المخصصة، يتم تنفيذ المنطق التالي (وهو جميعه مُنفَذ في onWorkerStart):
   ① تحميل الملفات المعينة في `config/autoload.php`، مثل `app/functions.php`
   ② تحميل الوسيطة المُعينة في `config/middleware.php` (بما في ذلك `config/plugin/*/*/middleware.php`)
   ③ تنفيذ `config/bootstrap.php` (بما في ذلك `config/plugin/*/*/bootstrap.php`)، وذلك لتهيئة بعض الوحدات، مثل اتصال قاعدة بيانات Laravel
   ④ تحميل `config/route.php` (بما في ذلك `config/plugin/*/*/route.php`)، والذي يعرف المسارات

## عملية معالجة الطلب

1. التحقق مما إذا كان عنوان URL للطلب يُطابق ملفًا ثابتًا في public، إذا كان كذلك يتم إرجاع الملف (انتهاء الطلب)، إذا كان لا يتم المتابعة إلى الخطوة 2
2. استنادًا إلى عنوان URL، التحقق مما إذا كان يُطابق أحد المسارات، إذا لم يكن، يتم المتابعة إلى الخطوة 3، وإذا كان كذلك، يتم المتابعة إلى الخطوة 4
3. التحقق مما إذا تم إغلاق المسار الافتراضي، إذا تم ذلك، يتم إرجاع كود 404 (انتهاء الطلب)، وإذا لم يتم ذلك، يتم المتابعة إلى الخطوة 4
4. العثور على وسيطة الطلب الخاصة بالتحكم، وتنفيذ الأنشطة الفرعية للوسيطة بالترتيب (مرحلة الطلب في نموذج البصل)، تنفيذ المنطق التجاري للتحكم، تنفيذ الأنشطة الختامية للوسيطة (مرحلة الاستجابة في نموذج البصل)، وانتهاء الطلب. (يرجى الرجوع إلى [نموذج وسيطة البصل](https://www.workerman.net/doc/webman/middleware.html#%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B))
